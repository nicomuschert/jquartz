//# sourceMappingURL=./jquartz.js.map
"use strict";$.fn.jQuartz=function(e={}){const t=$(this),a=createQuartzForm(t,e);return t.parent().append(a),t};const DEFAULT_PERIOD_TYPES=["yearly","monthly","weekly","daily","hourly","minutes","seconds"],WEEKDAYS=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],WEEKDAYS_SHORT=["MON","TUE","WED","THU","FRI","SAT","SUN"],MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],NTH=["First","Second","Third","Forth"];let formCount=0;const createQuartzForm=(e,t)=>{const a=()=>{const e=$("<select>").append(createOptionsFromRange(0,23,leadingZero)).val(12),t=$("<select>").append(createOptionsFromRange(0,59,leadingZero)),a=$("<select>").append(createOptionsFromRange(0,59,leadingZero)),r=$().add(e).add($("<span>").text(":")).add(t).add($("<span>").text(":")).add(a);return{form:$("<span>").append(r),model:{hour:e,minute:t,second:a},toQuartz:()=>`${parseInt(a.val())} ${parseInt(t.val())} ${parseInt(e.val())} * * ? *`,setQuartz:r=>{const s=splitQuartz(r);return e.val(s.h),t.val(s.m),a.val(s.s),s}}},r=`${formCount++}-${Math.ceil(1e18*Math.random()).toString(36)}`,s=String(e.val()),n=guessPeriodType(s),d={yearly:{option:"Yearly",form:e=>{const s={name:`yearly-${r}`},n=$('<input type="radio" value="day" checked>').attr(Object.assign(Object.assign({},s),{id:`${s.name}-day`})),d=$("<select>").append(createOptionsFromArray(MONTHS,MONTHS.map(((e,t)=>t+1)))),o=$("<select>").append(createOptionsFromRange(1,31)),i=$('<input type="radio" value="week">').attr(Object.assign(Object.assign({},s),{id:`${s.name}-week`})),c=$("<select>").append(createOptionsFromArray(NTH,NTH.map(((e,t)=>t+1)))),p=$("<select>").append(createOptionsFromArray(WEEKDAYS,WEEKDAYS_SHORT)),l=$("<select>").append(createOptionsFromArray(MONTHS,MONTHS.map(((e,t)=>t+1)))),u=a(),m={day:Object.assign({radio:n,month:d,day:o},u.model),week:Object.assign({radio:i,nthWeekday:c,weekday:p,month:l},u.model)};return{model:m,form:(t.renderSection||createSection)(e,m,[[n,$("<label>").attr("for",n[0].getAttribute("id")).text(" Every ").add(d).add($("<span>").text(" ")).add(o)],[i,$("<label>").attr("for",i[0].getAttribute("id")).text(" The ").add(c).add($("<span>").text(" ")).add(p).add($("<span>").text(" of ")).add(l)],[null,$("<span>").text("Start time ").add(u.form)]]),toQuartz:()=>{const e=u.toQuartz().split(" ",3).join(" ");if(n.is(":checked")){return`${e} ${parseInt(o.val())} ${parseInt(d.val())} ? *`}const t=parseInt(c.val()),a=p.val();return`${e} ? ${parseInt(l.val())} ${a}#${t} *`},setQuartz:e=>{const t=u.setQuartz(e);if("?"!==t.dom)n.prop("checked",!0),o.val(t.dom),d.val(t.month);else{const[e,a]=t.dow.split("#");i.prop("checked",!0),c.val(a),p.val(e),l.val(t.month)}}}}},monthly:{option:"Monthly",form:e=>{const s={name:`monthly-${r}`},n=$('<input type="radio" value="day" checked>').attr(Object.assign(Object.assign({},s),{id:`${s.name}-day`})),d=$("<select>").append(createOptionsFromRange(1,31)),o=$("<select>").append(createOptionsFromRange(1,12)),i=$('<input type="radio" value="week">').attr(Object.assign(Object.assign({},s),{id:`${s.name}-week`})),c=$("<select>").append(createOptionsFromArray(NTH,NTH.map(((e,t)=>t+1)))),p=$("<select>").append(createOptionsFromArray(WEEKDAYS,WEEKDAYS_SHORT)),l=$("<select>").append(createOptionsFromRange(1,12)),u=a(),m={day:Object.assign({radio:n,day:d,month:o},u.model),week:Object.assign({radio:i,nthWeekday:c,weekday:p,monthNumber:l},u.model)};return{model:m,form:(t.renderSection||createSection)(e,m,[[n,$("<label>").attr("for",n[0].getAttribute("id")).text(" Day ").add(d).add($("<span>").text(" of every ")).add(o).add($("<span>").text(" month(s)"))],[i,$("<label>").attr("for",i[0].getAttribute("id")).text(" The ").add(c).add($("<span>").text(" ")).add(p).add($("<span>").text(" of every ")).add(l).add($("<span>").text(" month(s)"))],[null,$("<span>").text("Start time ").add(u.form)]]),toQuartz:()=>{const e=u.toQuartz().split(" ",3).join(" ");if(n.is(":checked")){const t=parseInt(d.val()),a=parseInt(o.val());return`${e} ${t} ${1===a?"*":"1/"+a} ? *`}const t=p.val(),a=parseInt(c.val()),r=parseInt(l.val());return`${e} ? ${1===r?"*":"1/"+r} ${t}#${a} *`},setQuartz:e=>{const t=u.setQuartz(e),a="*"===t.month?"1":t.month.split("/")[1];if("?"!==t.dom)d.val(t.dom),o.val(a);else{const[e,r]=t.dow.split("#");i.prop("checked",!0),l.val(a),c.val(r),p.val(e)}}}}},weekly:{option:"Weekly",form:e=>{const s=WEEKDAYS_SHORT.reduce(((e,t)=>Object.assign(e,{[t]:$('<input type="checkbox">').attr({value:t,name:`weekday-${r}-${t.toLowerCase()}`,id:`weekday-${r}-${t.toLowerCase()}`})})),{}),n=WEEKDAYS.reduce(((e,t,a)=>e.add(labelCheckbox(s[WEEKDAYS_SHORT[a]],t))),$()),d=a(),o=Object.assign(Object.assign({},s),d.model);return{model:o,form:$("<div>").append((t.renderSection||createSection)(e,o,[n.slice(0,4).toArray(),n.slice(4).toArray().concat([null])])).append($("<div>").append((t.renderSection||createSection)("_",o,[[$("<span>").text("Start time"),d.form]]))),toQuartz:()=>{const e=WEEKDAYS_SHORT.filter((e=>s[e].is(":checked"))).join(",")||"*";return d.toQuartz().split(" ",3).join(" ")+` ? * ${e} *`},setQuartz:e=>{const t=d.setQuartz(e);WEEKDAYS_SHORT.forEach((e=>s[e].prop("checked",t.dow.includes(e))))}}}},daily:{option:"Daily",form:e=>{const s={name:`daily-${r}`},n=$('<input type="radio" value="every" checked>').attr(Object.assign(Object.assign({},s),{id:`${s.name}-every`})),d=$("<select>").append(createOptionsFromRange(1,100)),o=$('<input type="radio" value="clock">').attr(Object.assign(Object.assign({},s),{id:`${s.name}-clock`})),i=a(),c=a(),p={every:Object.assign({radio:n,ndays:d},i.model),clock:Object.assign({radio:o},c.model)};return{model:p,form:(t.renderSection||createSection)(e,p,[[n,$("<label>").attr("for",n[0].getAttribute("id")).text(" Every ").add(d).add($("<span>").text(" day(s) at ")).add(i.form)],[o,$("<label>").attr("for",o[0].getAttribute("id")).text(" Every week day at ").add(c.form)]]),toQuartz:()=>{if(o.is(":checked"))return c.toQuartz().split(" ",3).join(" ")+" ? * MON-FRI *";const e=parseInt(d.val());return i.toQuartz().split(" ",3).join(" ")+` ${1===e?"*":"1/"+e} * ? *`},setQuartz:e=>{if(e.includes("MON-FRI"))o.prop("checked",!0),c.setQuartz(e);else{const t=i.setQuartz(e);n.prop("checked",!0),d.val("*"===t.dom?"1":t.dom.split("/")[1])}}}}},hourly:{option:"Hourly",form:e=>{const s={name:`hourly-${r}`},n=$('<input type="radio" value="hour" checked>').attr(Object.assign(Object.assign({},s),{id:`${s.name}-hour`})),d=$("<select>").append(createOptionsFromRange(1,24)),o=$('<input type="radio" value="day">').attr(Object.assign(Object.assign({},s),{id:`${s.name}-day`})),i=a(),c={hour:{radio:n,hour:d},day:Object.assign({radio:o},i.model)};return{model:c,form:(t.renderSection||createSection)(e,c,[[n,$("<label>").attr("for",n[0].getAttribute("id")).text(" Every ").add(d).add($("<span>").text(" hour(s)"))],[o,$("<label>").attr("for",o[0].getAttribute("id")).text(" Every day at ").add(i.form)]]),toQuartz:()=>{if(o.is(":checked"))return i.toQuartz();const e=parseInt(d.val());return`0 0 ${1===e?"*":"0/"+e} * * ? *`},setQuartz:e=>{const t=splitQuartz(e);"*"===t.h||t.h.includes("/")?(n.prop("checked",!0),d.val("*"===t.h?"1":t.h.split("/")[1])):(o.prop("checked",!0),i.setQuartz(e))}}}},minutes:{option:"Minutes",form:e=>{const a=$("<select>").append(createOptionsFromRange(1,60,leadingZero)),r={minute:a};return{model:r,form:(t.renderSection||createSection)(e,r,[[$("<div>").append($("<span>").text("Every ")).append(a).append($("<span>").text(" minute(s)"))]]),toQuartz:()=>{const e=parseInt(a.val());return`0 ${1===e?"*":"0/"+e} * * * ? *`},setQuartz:e=>{const t=splitQuartz(e);a.val("*"===t.m?"1":t.m.split("/")[1])}}}},seconds:{option:"Seconds",form:e=>{const a=$("<select>").append(createOptionsFromRange(1,60,leadingZero)),r={second:a};return{model:r,form:(t.renderSection||createSection)(e,r,[[$("<div>").append($("<span>").text("Every ")).append(a).append($("<span>").text(" second(s)"))]]),toQuartz:()=>{const e=parseInt(a.val());return(1===e?"*":"0/"+e)+" * * * * ? *"},setQuartz:e=>{const t=splitQuartz(e);a.val("*"===t.s?"1":t.s.split("/")[1])}}}}},o=t=>{const a=e.val().split(" ").slice(7).join(" ");e.val(t+(a.length?` ${a}`:"")).trigger("change")},i=t.orderedPeriodTypes||DEFAULT_PERIOD_TYPES,c=i.map((e=>Object.assign({key:e},d[e]))).filter((e=>!!e.form)),p=$("<select>").append(createOptionsFromArray(c.map((e=>e.option)),c.map((e=>e.key)),n||i[0])).on("change",(function(){const{form:e,toQuartz:t}=m[p.val()];l.children().addClass("d-none"),e.removeClass("d-none"),o(t())})),l=$("<div>"),u=$('<div class="jquartz-form">').append($("<strong>").text("Select period: ")).append(p).append(l),m=c.reduce(((e,t)=>{const{form:a,model:r,toQuartz:d,setQuartz:c}=t.form(t.key),p=Object.values(r).reduce(((e,t)=>(t.length?[t]:Object.values(t)).reduce(((e,t)=>e.add(t)),e)),$());return t.key===n&&c(s),a.toggleClass("d-none",!(t.key===(n||i[0]))),p.on("change",(()=>o(d()))),l.append(a),Object.assign(Object.assign({},e),{[t.key]:{key:t.key,form:a,model:r,toQuartz:d}})}),{});return u},guessPeriodType=e=>{const t=[/^0\/\d+\s\*\s\*\s\*\s\*\s\?\s\*/,/^\*\s\*\s\*\s\*\s\*\s\?\s\*/].reduce(((t,a)=>t||a.test(e)),!1)&&"seconds",a=[/^0\s0\/\d+\s\*\s\*\s\*\s\?\s\*/,/^0\s\*\s\*\s\*\s\*\s\?\s\*/].reduce(((t,a)=>t||a.test(e)),!1)&&"minutes",r=[/^0\s0\s0\/\d+\s\*\s\*\s\?\s\*/,/^0\s0\s\*\s\*\s\*\s\?\s\*/,/^\d+\s\d+\s\d+\s\*\s\*\s\?\s\*/].reduce(((t,a)=>t||a.test(e)),!1)&&"hourly",s=[/^\d+\s\d+\s\d+\s1\/\d+\s\*\s\?\s\*/,/^\d+\s\d+\s\d+\s\*\s\*\s\?\s\*/,/^\d+\s\d+\s\d+\s\?\s\*\smon-fri\s\*/i].reduce(((t,a)=>t||a.test(e)),!1)&&"daily",n=[/^\d+\s\d+\s\d+\s\?\s\*\s\*\s\*$/,/^\d+\s\d+\s\d+\s\?\s\*\s[a-z,]+\s\*/i].reduce(((t,a)=>t||a.test(e)),!1)&&"weekly",d=[/^\d+\s\d+\s\d+\s[1-9]\d?\s\*\s\?\s\*/,/^\d+\s\d+\s\d+\s[1-9]\d?\s1\/\d+\s\?\s\*/,/^\d+\s\d+\s\d+\s\?\s1\/[1-9][0-2]?\s[a-z]+#\d\s\*/i,/^\d+\s\d+\s\d+\s\?\s\*\s[a-z]+#\d\s\*/i].reduce(((t,a)=>t||a.test(e)),!1)&&"monthly",o=[/^\d+\s\d+\s\d+\s\d+\s+\d+\s\?\s\*/,/^\d+\s\d+\s\d+\s\?\s\d+\s[a-z]+#\d\s\*/i].reduce(((t,a)=>t||a.test(e)),!1)&&"yearly";return t||a||s||r||n||d||o},splitQuartz=e=>{const[t,a,r,s,n,d,o]=e.toUpperCase().split(" ");return{s:t,m:a,h:r,dom:s,month:n,dow:d,year:o}},labelStartTime=e=>$("<div>").append($("<span>").text("Start time")).append(e),labelCheckbox=(e,t)=>$("<div>").append(e).append($("<label>").text(t).attr("for",e[0].getAttribute("name"))),createOptionsFromArray=(e,t,a)=>e.reduce(((e,r,s)=>{const n=String(t?t[s]:r),d=void 0!==a&&n===String(a);return e.add($("<option>").attr({value:n}).prop("selected",d).text(r))}),$()),leadingZero=e=>`${e<10?"0":""}${e}`,createOptionsFromRange=(e,t,a=(e=>`${e}`))=>{let r=$();for(var s=e;s<=t;s++)r=r.add($("<option>").attr("value",s).text(a(s)));return r},createSection=(e,t,a)=>{const r=e=>e.reduce(((e,t)=>e.add(s(t))),$()),s=e=>$("<td>").append(e);return $("<table>").append($("<tbody>").append(a.reduce(((e,t)=>e.add($("<tr>").append(r(t)))),$())))};